<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto - News</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .result {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        h1 { color: #4CAF50; }
        h2 { color: #2196F3; margin-top: 30px; }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste Direto da Tabela NEWS</h1>
    
    <div id="loading" class="loading">
        ‚è≥ Testando conex√£o e buscando dados...
    </div>

    <div id="results"></div>

    <script>
        const supabaseUrl = 'https://ezsjmevzlvhofdtbbwdn.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV6c2ptZXZ6bHZob2ZkdGJid2RuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNTQyMjgsImV4cCI6MjA2NDgzMDIyOH0.skr1ygMTLv0niDS3ID64E0b3V9rx4l5EkUK2LTICMrc';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');

        async function runTests() {
            let html = '';

            // Teste 1: Verificar conex√£o
            html += '<h2>‚úÖ Teste 1: Conex√£o com Supabase</h2>';
            html += '<div class="result">';
            html += '<p><strong>URL:</strong> ' + supabaseUrl + '</p>';
            html += '<p><strong>Status:</strong> Conectado ‚úì</p>';
            html += '</div>';

            // Teste 2: Buscar TODAS as not√≠cias (sem filtro published)
            html += '<h2>üìä Teste 2: Buscar TODAS as not√≠cias (sem filtro)</h2>';
            try {
                const { data: allNews, error: allError, count } = await supabase
                    .from('news')
                    .select('*', { count: 'exact' });

                if (allError) throw allError;

                html += '<div class="result">';
                html += '<p><strong>Total de registros:</strong> ' + (allNews?.length || 0) + '</p>';
                html += '<pre>' + JSON.stringify(allNews, null, 2) + '</pre>';
                html += '</div>';
            } catch (error) {
                html += '<div class="result error">';
                html += '<p><strong>‚ùå ERRO:</strong></p>';
                html += '<pre>' + JSON.stringify(error, null, 2) + '</pre>';
                html += '</div>';
            }

            // Teste 3: Buscar apenas publicadas
            html += '<h2>üì∞ Teste 3: Buscar apenas not√≠cias PUBLICADAS</h2>';
            try {
                const { data: publishedNews, error: pubError } = await supabase
                    .from('news')
                    .select('*')
                    .eq('published', true)
                    .order('created_at', { ascending: false });

                if (pubError) throw pubError;

                html += '<div class="result">';
                html += '<p><strong>Not√≠cias publicadas:</strong> ' + (publishedNews?.length || 0) + '</p>';
                html += '<pre>' + JSON.stringify(publishedNews, null, 2) + '</pre>';
                html += '</div>';
            } catch (error) {
                html += '<div class="result error">';
                html += '<p><strong>‚ùå ERRO:</strong></p>';
                html += '<pre>' + JSON.stringify(error, null, 2) + '</pre>';
                html += '</div>';
            }

            // Teste 4: Verificar estrutura da tabela
            html += '<h2>üîç Teste 4: Primeiros registros com estrutura</h2>';
            try {
                const { data: sample, error: sampleError } = await supabase
                    .from('news')
                    .select('id, title, category, published, author, created_at')
                    .limit(5);

                if (sampleError) throw sampleError;

                html += '<div class="result">';
                html += '<p><strong>Amostra de 5 registros:</strong></p>';
                html += '<pre>' + JSON.stringify(sample, null, 2) + '</pre>';
                html += '</div>';
            } catch (error) {
                html += '<div class="result error">';
                html += '<p><strong>‚ùå ERRO:</strong></p>';
                html += '<pre>' + JSON.stringify(error, null, 2) + '</pre>';
                html += '</div>';
            }

            // Teste 5: Contar registros por status
            html += '<h2>üìà Teste 5: Estat√≠sticas</h2>';
            try {
                const { count: totalCount } = await supabase
                    .from('news')
                    .select('*', { count: 'exact', head: true });

                const { count: publishedCount } = await supabase
                    .from('news')
                    .select('*', { count: 'exact', head: true })
                    .eq('published', true);

                const { count: unpublishedCount } = await supabase
                    .from('news')
                    .select('*', { count: 'exact', head: true })
                    .eq('published', false);

                html += '<div class="result">';
                html += '<p><strong>Total:</strong> ' + (totalCount || 0) + '</p>';
                html += '<p><strong>Publicadas:</strong> ' + (publishedCount || 0) + '</p>';
                html += '<p><strong>N√£o publicadas:</strong> ' + (unpublishedCount || 0) + '</p>';
                html += '</div>';
            } catch (error) {
                html += '<div class="result error">';
                html += '<p><strong>‚ùå ERRO:</strong></p>';
                html += '<pre>' + JSON.stringify(error, null, 2) + '</pre>';
                html += '</div>';
            }

            loadingDiv.style.display = 'none';
            resultsDiv.innerHTML = html;
        }

        runTests();
    </script>
</body>
</html>
